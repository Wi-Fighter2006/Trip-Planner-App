<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Trip Planner Pro - Discover & Plan</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Lora:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        :root {
            --primary-color: #367cff; --primary-light: #6b9eff; --secondary-color: #ffc107;
            --background-color: #0b0f19; --card-bg-color: rgba(255, 255, 255, 0.08);
            --text-color: #e0e0e0; --heading-color: #ffffff; --border-color: rgba(255, 255, 255, 0.2);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideIn { from { opacity: 0; transform: translateX(50px); } to { opacity: 1; transform: translateX(0); } }
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-15px); } 100% { transform: translateY(0px); } }

        body {
            font-family: 'Poppins', sans-serif; background-color: var(--background-color);
            background-image: url('https://images.unsplash.com/photo-1501785888041-af3ef285b470?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80');
            background-size: cover; background-position: center; background-attachment: fixed;
            color: var(--text-color); line-height: 1.8; margin: 0; padding: 2rem; overflow-x: hidden;
        }
        
        /* --- LANDMARK GALLERY --- */
        .landmark-gallery { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; overflow: hidden; }
        .landmark { position: absolute; background-size: cover; background-position: center; border-radius: 16px; box-shadow: var(--shadow); transition: transform 0.3s ease; }
        .landmark:hover { transform: scale(1.1) !important; }

        .container { max-width: 850px; margin: auto; position: relative; z-index: 2; }
        header { text-align: center; margin-bottom: 3rem; animation: fadeIn 1s ease-out; }
        header h1 { font-family: 'Lora', serif; font-size: 3rem; color: var(--heading-color); margin-bottom: 0.5rem; text-shadow: 0 2px 10px rgba(0,0,0,0.5); }
        header p { font-family: 'Lora', serif; font-style: italic; color: #f0f0f0; font-size: 1.2rem; }

        .glass-card { background: var(--card-bg-color); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid var(--border-color); border-radius: 16px; box-shadow: var(--shadow); padding: 2.5rem; animation: fadeIn 1s ease-out; }
        #itinerary-form { margin-bottom: 3rem; overflow: hidden; position: relative; min-height: 350px; }

        /* --- UPDATED MULTI-STEP FORM --- */
        .form-step { display: none; text-align: center; animation: slideIn 0.5s ease-out forwards; }
        .form-step.active { display: block; }
        .form-step h2 { font-family: 'Lora', serif; font-size: 1.8rem; margin-bottom: 2rem; color: var(--heading-color); }
        .form-group { max-width: 400px; margin: 0 auto 2rem auto; position: relative; }
        .form-group input { text-align: center; font-size: 1.2rem; background: rgba(0,0,0,0.2); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-color); width: 100%; padding: 0.8rem 1rem; box-sizing: border-box; }
        
        /* Destination Suggestions */
        #suggestions-box { position: absolute; width: 100%; background: rgba(30, 40, 60, 0.9); backdrop-filter: blur(5px); border-radius: 8px; list-style: none; padding: 0; margin-top: 5px; text-align: left; max-height: 200px; overflow-y: auto; z-index: 10; }
        #suggestions-box li { padding: 10px 15px; cursor: pointer; border-bottom: 1px solid var(--border-color); }
        #suggestions-box li:last-child { border-bottom: none; }
        #suggestions-box li:hover { background: var(--primary-color); }
        
        .budget-group { display: flex; background: rgba(0,0,0,0.2); border: 1px solid var(--border-color); border-radius: 8px;}
        .budget-group input { border-radius: 8px 0 0 8px; border-right: none; border: none; }
        .budget-group select { border: none; background: rgba(0,0,0,0.3); padding: 0 1rem; font-weight: 600; color: var(--text-color); border-radius: 0 8px 8px 0; cursor: pointer; }
        
        .form-navigation { display: flex; justify-content: center; gap: 1rem; margin-top: 3rem; }
        .btn { padding: 0.8rem 2rem; border: none; border-radius: 50px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; }
        .btn-back { background: transparent; border: 2px solid var(--border-color); color: var(--text-color); }
        .btn-next, .btn-submit { background: linear-gradient(45deg, var(--primary-color), var(--primary-light)); color: white; border: 2px solid transparent; }
        
        .progress-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 3rem; position: relative; }
        .progress-step { width: 30px; height: 30px; background: rgba(0,0,0,0.3); border: 2px solid var(--border-color); border-radius: 50%; display: flex; justify-content: center; align-items: center; color: var(--text-color); font-weight: bold; z-index: 2; transition: all 0.4s ease; }
        .progress-step.active { background: var(--primary-color); border-color: var(--primary-light); color: white; transform: scale(1.2); }
        .progress-bar::before { content: ''; position: absolute; top: 50%; left: 0; transform: translateY(-50%); height: 4px; width: 100%; background: var(--border-color); z-index: 1; }
        #progress-line { position: absolute; top: 50%; left: 0; transform: translateY(-50%); height: 4px; width: 0%; background: var(--primary-color); z-index: 1; transition: width 0.4s ease; }
        
        .hidden { display: none; }
        .result-card, .loading-card { margin-bottom: 2rem; } /* Simplified the rest of the styles */
    </style>
</head>
<body>
    <div class="landmark-gallery" id="landmark-gallery"></div>

    <div class="container">
        <header>
            <h1>Trip Planner Pro</h1>
            <p id="travel-quote">Loading an inspiring thought for you...</p>
        </header>

        <div id="itinerary-form" class="glass-card">
            <form>
                <div class="progress-bar">
                    <div id="progress-line"></div>
                    <div class="progress-step active" data-step="1">1</div>
                    <div class="progress-step" data-step="2">2</div>
                    <div class="progress-step" data-step="3">3</div>
                </div>
                
                <div class="form-step active" data-step="1">
                    <h2>Where would you like to explore?</h2>
                    <div class="form-group">
                        <input type="text" id="destination" name="destination" placeholder="Start typing a city or country..." required autocomplete="off">
                        <ul id="suggestions-box"></ul>
                    </div>
                    <div class="form-navigation"><button type="button" class="btn btn-next">Next &rarr;</button></div>
                </div>
                
                <div class="form-step" data-step="2">
                    <h2>How long is your adventure?</h2>
                    <div class="form-group"><input type="number" id="days" name="days" placeholder="e.g., 7 Days" required></div>
                    <div class="form-navigation"><button type="button" class="btn btn-back">&larr; Back</button><button type="button" class="btn btn-next">Next &rarr;</button></div>
                </div>

                <div class="form-step" data-step="3">
                    <h2>What's your travel budget?</h2>
                    <div class="form-group"><div class="budget-group"><input type="number" id="budget" name="budget" placeholder="e.g., 2000" required><select id="currency" name="currency"><option value="USD">USD ($)</option><option value="INR">INR (₹)</option><option value="EUR">EUR (€)</option></select></div></div>
                    <div class="form-navigation"><button type="button" class="btn btn-back">&larr; Back</button><button type="submit" class="btn btn-submit"><i class="fas fa-magic"></i> Create My Trip</button></div>
                </div>
            </form>
        </div>
        <div id="loading" class="hidden glass-card loading-card"></div>
        <div id="results" class="hidden"></div>
    </div>

    <script>
        // --- DYNAMIC QUOTE SCRIPT ---
        const quotes = ["\"The world is a book and those who do not travel read only one page.\" – St. Augustine", "\"Not all those who wander are lost.\" – J.R.R. Tolkien", "\"Life is either a daring adventure or nothing at all.\" – Helen Keller"];
        document.getElementById('travel-quote').textContent = quotes[Math.floor(Math.random() * quotes.length)];

        // --- ANIMATED LANDMARK GALLERY SCRIPT ---
        const landmarks = [ 'https://images.unsplash.com/photo-1524492412937-b28074a5d7da?w=400', 'https://images.unsplash.com/photo-1555881400-69a2384edcd4?w=400', 'https://images.unsplash.com/photo-1588614959068-012b1d03ba34?w=400', 'https://images.unsplash.com/photo-1528181304800-259b08848526?w=400', 'https://images.unsplash.com/photo-1576487248805-cf4d9f379e42?w=400', 'https://images.unsplash.com/photo-1517650862521-d580d534502c?w=400' ];
        const gallery = document.getElementById('landmark-gallery');
        landmarks.forEach(url => {
            const img = document.createElement('div');
            img.className = 'landmark'; img.style.backgroundImage = `url(${url})`;
            img.style.width = `${Math.random()*100+100}px`; img.style.height = `${Math.random()*100+150}px`;
            img.style.animation = `float ${Math.random()*5+5}s ease-in-out infinite`;
            if (Math.random() > 0.5) { img.style.left = `${Math.random()*15}%`; } else { img.style.right = `${Math.random()*15}%`; }
            img.style.top = `${Math.random()*80}%`;
            gallery.appendChild(img);
        });

        // --- "SMART SEARCH" DESTINATION SUGGESTION LOGIC ---
        const destinationInput = document.getElementById('destination');
        const suggestionsBox = document.getElementById('suggestions-box');
        let debounceTimer;

        destinationInput.addEventListener('keyup', () => {
            clearTimeout(debounceTimer);
            const query = destinationInput.value;
            if (query.length < 2) {
                suggestionsBox.innerHTML = ''; return;
            }
            debounceTimer = setTimeout(() => {
                getDestinationSuggestions(query);
            }, 400); // Wait 400ms after user stops typing
        });

        async function getDestinationSuggestions(query) {
            try {
                const response = await fetch('/suggest_destinations', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query })
                });
                const destinations = await response.json();
                suggestionsBox.innerHTML = '';
                destinations.forEach(dest => {
                    const li = document.createElement('li');
                    li.textContent = dest;
                    li.onclick = () => {
                        destinationInput.value = dest;
                        suggestionsBox.innerHTML = '';
                    };
                    suggestionsBox.appendChild(li);
                });
            } catch (error) {
                console.error("Suggestion fetch error:", error);
            }
        }
        
        // --- MULTI-STEP FORM LOGIC ---
        const form = document.querySelector('#itinerary-form form');
        const nextButtons = form.querySelectorAll('.btn-next');
        const backButtons = form.querySelectorAll('.btn-back');
        const formSteps = form.querySelectorAll('.form-step');
        const progressSteps = form.querySelectorAll('.progress-step');
        const progressLine = document.getElementById('progress-line');
        let currentStep = 1;

        nextButtons.forEach(button => {
            button.addEventListener('click', () => {
                const input = form.querySelector(`.form-step[data-step="${currentStep}"] input`);
                if (input && !input.value) { alert('Please fill in this field.'); return; }
                if (currentStep < formSteps.length) { currentStep++; updateFormSteps(); }
            });
        });
        backButtons.forEach(button => {
            button.addEventListener('click', () => { if (currentStep > 1) { currentStep--; updateFormSteps(); } });
        });
        function updateFormSteps() {
            formSteps.forEach(step => step.classList.remove('active'));
            form.querySelector(`.form-step[data-step="${currentStep}"]`).classList.add('active');
            updateProgressBar();
        }
        function updateProgressBar() {
            progressSteps.forEach((step, index) => { step.classList.toggle('active', index < currentStep); });
            progressLine.style.width = ((form.querySelectorAll('.progress-step.active').length - 1) / (progressSteps.length - 1)) * 100 + '%';
        }

        // --- MAIN FORM SUBMISSION LOGIC ---
        let loadingInterval;
        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(form);
            const resultsDiv = document.getElementById('results');
            const loadingDiv = document.getElementById('loading');
            const formContainer = document.getElementById('itinerary-form');
            
            formContainer.style.display = 'none';
            resultsDiv.innerHTML = ''; // Clear old results
            resultsDiv.classList.add('hidden');
            loadingDiv.innerHTML = `<div class="spinner"></div><p id="loading-text">Crafting your journey...</p>`;
            loadingDiv.classList.remove('hidden');

            const loadingText = document.getElementById('loading-text');
            loadingInterval = setInterval(async () => {
                const response = await fetch('/loading_text');
                const data = await response.json();
                loadingText.textContent = data.tip;
            }, 3000);

            try {
                const response = await fetch('/generate', { method: 'POST', body: formData });
                const data = await response.json();
                
                resultsDiv.innerHTML = `
                    <div class="result-card glass-card"><h3><i class="fas fa-paper-plane"></i>Trip Summary</h3>${marked.parse(data.high_level_plan)}</div>
                    <div class="result-card glass-card"><h3><i class="fas fa-calendar-day"></i>Day-by-Day Plan</h3><div id="daily-itinerary-accordion"></div></div>
                    <div class="result-card glass-card"><h3><i class="fas fa-utensils"></i>Dining Recommendations</h3>${marked.parse(data.dining_recommendations)}</div>
                    <div class="result-card glass-card"><h3><i class="fas fa-suitcase-rolling"></i>Packing List</h3>${marked.parse(data.packing_list)}</div>
                    <div class="result-card glass-card"><h3><i class="fas fa-star"></i>Fun Fact</h3><p>${data.fun_fact}</p></div>
                    <div class="result-card glass-card"><h3><i class="fas fa-map-location-dot"></i>Your Map</h3><p><a href="${data.maps_link}" target="_blank">Open Interactive Map</a></p></div>
                `;

                const accordionContainer = document.getElementById('daily-itinerary-accordion');
                const days = data.daily_itinerary.split(/\*\*(Day \d+:.*?)\*\*/).filter(Boolean);
                for (let i = 0; i < days.length; i += 2) {
                    accordionContainer.innerHTML += `<div class="accordion-item"><div class="accordion-header">${days[i]}</div><div class="accordion-content">${marked.parse(days[i+1].trim())}</div></div>`;
                }
                
                resultsDiv.classList.remove('hidden');
                addAccordionListeners();
                
                document.querySelectorAll('.result-card').forEach((card, index) => {
                    setTimeout(() => card.classList.add('card-animate'), index * 150);
                });

            } catch (error) {
                console.error('Error:', error);
                resultsDiv.innerHTML = '<div class="result-card glass-card"><p>An error occurred. Please try again.</p></div>';
            } finally {
                clearInterval(loadingInterval);
                loadingDiv.classList.add('hidden');
            }
        });

        function addAccordionListeners() {
             document.querySelectorAll('.accordion-header').forEach(header => {
                header.addEventListener('click', () => {
                    const item = header.parentElement; item.classList.toggle('active');
                    const content = header.nextElementSibling;
                    content.style.maxHeight = item.classList.contains('active') ? content.scrollHeight + "px" : null;
                });
            });
        }
    </script>
</body>
</html>
